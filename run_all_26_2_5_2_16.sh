#!/bin/bash

# å¯ä»¥åœ¨è¿™é‡ŒæŒ‡å®šä½ è¦è·‘å“ªäº› Foldï¼Œæ¯”å¦‚ {0..4} è¡¨ç¤ºè·‘ 0,1,2,3,4
for fold in {1..4}
do
    echo "=========================================================="
    echo "ğŸš€ [$(date)] å¼€å§‹è®­ç»ƒ Fold ${fold} (Model: SwinUNETR)..."
    echo "=========================================================="

    # è¿è¡Œè®­ç»ƒå‘½ä»¤ (8å¡)
    torchrun --nproc_per_node=8 src/train_baseline.py --fold ${fold} --model swinunet

    # æ£€æŸ¥ä¸Šä¸€æ¡å‘½ä»¤æ˜¯å¦æˆåŠŸï¼Œå¤±è´¥åˆ™åœæ­¢ï¼Œé˜²æ­¢ä¸€ç›´æŠ¥é”™
    if [ $? -ne 0 ]; then
        echo "âŒ Fold ${fold} è®­ç»ƒå¤±è´¥ï¼è„šæœ¬ç»ˆæ­¢ã€‚"
        exit 1
    fi

    echo "âœ… Fold ${fold} å®Œæˆï¼"
    
    # ä¼‘æ¯ 30 ç§’ï¼Œç¡®ä¿æ˜¾å­˜å®Œå…¨é‡Šæ”¾ï¼Œé˜²æ­¢ä¸‹ä¸€ä¸ª Fold å¯åŠ¨æ—¶ OOM
    echo "ğŸ’¤ ç­‰å¾… 30 ç§’é‡Šæ”¾æ˜¾å­˜..."
    sleep 30
done

echo "ğŸ‰ æ‰€æœ‰ Fold è®­ç»ƒå…¨éƒ¨å®Œæˆï¼"